<?php

namespace App\Http\Controllers;

use App\Services\NmapScanner;
use Illuminate\Http\Request;

class PentestingController extends Controller
{
     protected $nmapScanner;

    /**
     * PentestingController constructor.
     *
     * @param NmapScanner $nmapScanner
     */
    public function __construct(NmapScanner $nmapScanner)
    {
        $this->nmapScanner = $nmapScanner;
    }

    /**
     * Run Nmap scan on the provided target
     *
     * @param Request $request
     * @return \Illuminate\Http\JsonResponse
     */
    public function scan(Request $request)
    {
        # Validate req
        $request->validate([ 'target' => 'required|string', ]);

        # Call NmapScanner service
        $result = $this->nmapScanner->scanTarget($request->target);

        # Check result status and return appropriate response
        if ($result['status'] === 'success') {
            return response()->json([ 'message' => 'Scan completed successfully', 'data' => $result['data'] ], 200);
        }

        return response()->json([ 'message' => 'Scan failed', 'error' => $result['message'] ], 400);
    }
}
